<html>
<head>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <script type="text/javascript" src="crypto/rollups/hmac-sha256.js"></script>

    <!--

amida-indaba
Access Key ID:
AKIAIWUKVZJ6NTM4GD5Q
Secret Access Key:
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


Policy: AmazonS3FullAccess

    -->

</head>
<body>

<script type="text/javascript">

    var key = 'AKIAIWUKVZJ6NTM4GD5Q';
    var dateStamp = '20160527';
    var regionName = 'us-east-1';
    var serviceName = 's3';

    var policy = { "expiration": "2016-05-28T12:00:00.000Z",
        "conditions": [
            {"bucket": "ntrlab-amida-indaba"},
            ["starts-with", "$key", "user/user1/"],
            {"acl": "public-read"},
            {"success_action_redirect": "http://indaba.ntrlab.ru"},
            ["starts-with", "$Content-Type", "image/"],
            {"x-amz-meta-uuid": "14365123651274"},
            {"x-amz-server-side-encryption": "AES256"},
            ["starts-with", "$x-amz-meta-tag", ""],
            {"x-amz-credential": "AKIAIWUKVZJ6NTM4GD5Q/20160527/us-east-1/s3/aws4_request"},
            {"x-amz-algorithm": "AWS4-HMAC-SHA256"},
            {"x-amz-date": "20160527T000000Z" }
        ]
    };

    function getSign() {
        alert(getSignatureKey(key, dateStamp, regionName, serviceName));
    }

    function getSignatureKey(key, dateStamp, regionName, serviceName) {
        var kDate= CryptoJS.HmacSHA256(dateStamp, "AWS4" + key, { asBytes: true});
        var kRegion = CryptoJS.HmacSHA256(regionName, kDate, { asBytes: true });
        var kService = CryptoJS.HmacSHA256(serviceName, kRegion, { asBytes: true });
        var kSigning = CryptoJS.HmacSHA256("aws4_request", kService, { asBytes: true });
        return kSigning;
    }

</script>

<button onclick="getSign()">Get sign</button>

<form action="http://sigv4examplebucket.s3.amazonaws.com/" method="post" enctype="multipart/form-data">
    Key to upload:
    <input type="text" name="key" value="user/user1/db.jpeg" />
    <br />

    ACL
    <input type="text" name="acl" value="public-read" />
    <br />

    success_action_redirect
    <input type="text" name="success_action_redirect" value="http://indaba.ntrlab.ru" />
    <br />

    Content-Type:
    <input type="text" name="Content-Type" value="image/jpeg" />
    <br />

    x-amz-meta-uuid
    <input type="text" name="x-amz-meta-uuid" value="14365123651274" /> ???
    <br />

    x-amz-server-side-encryption
    <input type="text" name="x-amz-server-side-encryption" value="AES256" /> ???
    <br />

    X-Amz-Credential
    <input type="text" name="X-Amz-Credential" value="AKIAIWUKVZJ6NTM4GD5Q/20160527/us-east-1/s3/aws4_request" />????
    <br />

    X-Amz-Algorithm
    <input type="text" name="X-Amz-Algorithm" value="AWS4-HMAC-SHA256" />
    <br />

    X-Amz-Date
    <input type="text" name="X-Amz-Date" value="20160527T000000Z" />
    <br/>

    Tags for File:
    <input type="text" name="x-amz-meta-tag" value="" />
    <br />

    Policy
    <input type="text" id="policy" name="Policy" value=''/>
    <br />

    X-Amz-Signature
    <input type="text" id="signature" name="X-Amz-Signature" value="" />
    <br/>

    File:
    <input type="file" name="file" />
    <br />
    <!-- The elements after this will be ignored -->
    <input type="submit" name="submit" value="Upload to Amazon S3" />
</form>
</body>
</html>